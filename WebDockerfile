FROM ruby:2.4-stretch

ENV PYTHONPATH="/code"
ADD . /code

RUN gem install bundle vmfloaty

ADD .vmfloaty.yml /root/.vmfloaty.yml

WORKDIR /code
RUN set -ex \
  && apt-get update \
  && apt-get install -y --no-install-recommends python-dev python-pip python-setuptools python-wheel \
  && rm -rf /var/lib/apt/lists/*

RUN pip install -r service-requirements.txt

ENTRYPOINT gunicorn -w 4 -b 0.0.0.0:5000 web.frankenbuild:app
